<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- App css -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <!-- <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> -->
    <link rel="stylesheet" href="style.css" />
    <title>Hello World ChartJs</title>
  </head>
  <body class="p-4 m-0">
    <div class="p-0 m-0">
      <!-- Quantity Detail -->
      <a href="./dashboard.html" class="link">< Back</a>
      <p id="machine-name" class="fs-2"></p>
      <div class="row p-0 m-0">
        <div class="col">
          <!-- Product Quantity  -->
          <div class="border border-white box-content row me-2 p-2">
            <canvas id="quantityBarChart" style="max-height: 150px"></canvas>
          </div>
          <div class="row">
            <div
              class="col box-content border border-white my-3 p-2 text-center"
            >
              <p class="fs-4">
                Good Parts <br />
                <span id="good-parts" class="fw-bolder"></span>
              </p>
            </div>
            <div
              class="col box-content border border-white m-3 p-2 text-center"
            >
              <p class="fs-4">
                Total Parts <br />
                <span id="total-parts" class="fw-bolder"></span>
              </p>
            </div>
          </div>
        </div>

        <!-- Production Rate -->
        <div class="col-4 p-3 mb-3 box-content border border-white">
          <p class="col-12 fs-3 mx-2">Production Rate</p>
          <canvas id="semiCircleChart" style="max-height: 150px"></canvas>
        </div>
      </div>

      <!-- Key Performance Indicators -->
      <div class="row p-0 m-0 box-content">
        <!-- OEE -->
        <div class="col my-auto">
          <canvas id="oeeChart"></canvas>
        </div>

        <!-- Availability -->
        <div class="col">
          <div class="">
            <canvas id="availabilityChart"></canvas>
          </div>
          <!-- availability table -->
          <div>
            <table class="table table-bordered">
              <thead class="thead-light">
                <tr>
                  <th>Availability</th>
                  <th id="availability"></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Planned Runtime</td>
                  <td id="planned-runtime"></td>
                </tr>
                <tr>
                  <td>Actual Runtime</td>
                  <td id="actual-runtime"></td>
                </tr>
                <tr>
                  <td>Unplanned Downtime</td>
                  <td id="unplanned-downtime"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Performance -->
        <div class="col">
          <div>
            <canvas id="performanceChart"></canvas>
          </div>
          <!-- performance table -->
          <div>
            <table class="table table-bordered">
              <thead class="thead-light">
                <tr>
                  <th>Performance</th>
                  <th id="performance"></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Planned Quantity</td>
                  <td id="planned-quantity"></td>
                </tr>
                <tr>
                  <td>Actual Quantity</td>
                  <td id="actual-quantity"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Quality -->
        <div class="col">
          <div>
            <canvas id="quantityChart"></canvas>
          </div>
          <!-- quality table -->
          <div>
            <table class="table table-bordered">
              <thead class="thead-light">
                <tr>
                  <th>Quality</th>
                  <th id="quality"></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Actual Quantity</td>
                  <td id="total-quantity"></td>
                </tr>
                <tr>
                  <td>Reject Quantity</td>
                  <td id="reject-quantity"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      var socket = io();

      socket.on("test", (data) => {
        console.log(data);
      });

      let machineId = window.localStorage.getItem("machineId");
      socket.emit("sendMachineId", machineId);

      socket.on("machineDetail", (data) => {
        let machine = data;

        // Overall
        document.getElementById("machine-name").innerHTML = machine.mc_name;
        document.getElementById("good-parts").innerHTML = machine.parts.good_parts;
        document.getElementById("total-parts").innerHTML = machine.parts.total_parts;
        // oee
        document.getElementById("availability").innerHTML = machine.oee.availability +" %";
        document.getElementById("performance").innerHTML = machine.oee.performance+" %";
        document.getElementById("quality").innerHTML = machine.oee.quality+" %";
        // Availability
        document.getElementById("planned-runtime").innerHTML = machine.availability.planned_runtime+" minute";
        document.getElementById("actual-runtime").innerHTML = machine.availability.actual_runtime+" minute";
        document.getElementById("unplanned-downtime").innerHTML = machine.availability.unplanned_downtime+" minute";
        // Performance
        document.getElementById("planned-quantity").innerHTML = machine.performance.planned_quantity+" parts";
        document.getElementById("actual-quantity").innerHTML = machine.performance.actual_quantity+" parts"; 
      // Quality
        document.getElementById("total-quantity").innerHTML = machine.quality.actual_quantity+" parts";
        document.getElementById("reject-quantity").innerHTML = machine.quality.reject_quantity+" parts";

        // horizontal bar chart
        let qtChart = document.getElementById("quantityBarChart").getContext("2d");
        let quantitybarChart = new Chart(qtChart, {
          data: {
            labels: ["", "Product Quantity", ""],
            datasets: [
              {
                type: "bar",
                label:"quantity",
                axis: "x",
                data: [0, `${machine.parts.total_parts}`, 0 ],
                fill: false,
                backgroundColor: "#74c69d",
                borderColor: "#777",
                borderWidth: 1,
              },
              {
                type: "line",
                label: "Expected Quantity",
                data: [`${machine.parts.expected_quantity}`,`${machine.parts.expected_quantity}`,`${machine.parts.expected_quantity}`],
                fill: false,
                borderColor: "rgb(54, 162, 235)",
                pointStyle: "circle",
              },
            ],
          },
          options: {
            color: "#f2e8cf",
            indexAxis: "y",
            // labels:{
            //   fontColor : "#f2e8cf",
            // }
          },
        });

        // OEE-doughnut chart
        let dnChart = document.getElementById("oeeChart").getContext("2d");
        let oeeDn = new Chart(dnChart, {
          type: "doughnut",
          data: {
            datasets: [
              {
                label: "OEE",
                data: [86, 14],
                backgroundColor: ["#74c69d", "#f2e8cf"],
                borderWidth: 1,
                borderColor: "#777",
                hoverBorderWidth: 3,
                hoverBorderColor: "#000",
              },
            ],
          },
          options: {
            title: {
              display: true,
              text: "OEE",
              fontSize: 25,
            },
            legend: {
              display: true,
              position: "right",
            },
            layout: {
              padding: {
                left: 50,
                right: 0,
                top: 0,
                bottom: 0,
              },
            },
          },
        });

        // availability-doughnut chart
        let availabilityChart = document
          .getElementById("availabilityChart")
          .getContext("2d");
        let availabilityDn = new Chart(availabilityChart, {
          type: "doughnut",
          data: {
            datasets: [
              {
                label: "Availability",
                data: [`${machine.oee.availability}`,`${100-machine.oee.availability}`],
                backgroundColor: ["#74c69d", "#f2e8cf"],
                borderWidth: 1,
                borderColor: "#777",
                hoverBorderWidth: 3,
                hoverBorderColor: "#000",
              },
            ],
          },
          options: {
            title: {
              display: true,
              text: "OEE",
              fontSize: 25,
            },
            legend: {
              display: true,
              position: "right",
            },
            layout: {
              padding: {
                left: 50,
                right: 0,
                top: 0,
                bottom: 0,
              },
            },
          },
        });
       // Performance-doughnut chart
       let performanceChart = document
          .getElementById("performanceChart")
          .getContext("2d");
        let performanceDn = new Chart(performanceChart, {
          type: "doughnut",
          data: {
            datasets: [
              {
                label: "Performance",
                data: [`${machine.oee.performance}`,`${100-machine.oee.performance}`],
                backgroundColor: ["#74c69d", "#f2e8cf"],
                borderWidth: 1,
                borderColor: "#777",
                hoverBorderWidth: 3,
                hoverBorderColor: "#000",
              },
            ],
          },
          options: {
            title: {
              display: true,
              text: "OEE",
              fontSize: 25,
            },
            legend: {
              display: true,
              position: "right",
            },
            layout: {
              padding: {
                left: 50,
                right: 0,
                top: 0,
                bottom: 0,
              },
            },
          },
        });    
           
        // Quantity-doughnut chart
        let quantityChart = document
          .getElementById("quantityChart")
          .getContext("2d");
        let quantityDn = new Chart(quantityChart, {
          type: "doughnut",
          data: {
            datasets: [
              {
                label: "Quantity",
                data: [`${machine.oee.quality}`,`${100-machine.oee.quality}`],
                backgroundColor: ["#74c69d", "#f2e8cf"],
                borderWidth: 1,
                borderColor: "#777",
                hoverBorderWidth: 3,
                hoverBorderColor: "#000",
              },
            ],
          },
          options: {
            title: {
              display: true,
              text: "OEE",
              fontSize: 25,
            },
            legend: {
              display: true,
              position: "right",
            },
            layout: {
              padding: {
                left: 50,
                right: 0,
                top: 0,
                bottom: 0,
              },
            },
          },
        });
        //  semi circle chart
        let scChart = document
          .getElementById("semiCircleChart")
          .getContext("2d");
        let semiCirlceChart = new Chart(scChart, {
          type: "doughnut",
          data: {
            datasets: [
              {
                label: "OEE",
                data: [86, 14],
                backgroundColor: ["#74c69d", "#f2e8cf"],
                borderWidth: 1,
                borderColor: "#777",
                hoverBorderWidth: 3,
                hoverBorderColor: "#000",
              },
            ],
          },
          options: {
            rotation: -90,
            circumference: 180,
            cutout: "70%",
            title: {
              display: false,
            },
            legend: {
              display: true,
              position: "right",
            },
            layout: {
              padding: {
                left: 50,
                right: 0,
                top: 0,
                bottom: 0,
              },
            },
          },
        });
      });
    </script>
  </body>
</html>
